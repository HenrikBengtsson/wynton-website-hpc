<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>gpu – UCSF Wynton HPC Cluster</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-98e2a9b0d4696fd01dd9970aef6a652a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Create UCSF banner element
  var banner = document.createElement('div');
  banner.className = 'top-banner logo';
  banner.innerHTML = `
    <div class="inner">
      <div>
        <div class="logo"></div>
        <a class="logotype" href="https://www.ucsf.edu/">
          <span>University of California San Francisco</span>
        </a>
      </div>
      <div class="nav">
        <ul class="top-banner-menu">
          <li><a href="https://www.ucsf.edu/about">About UCSF</a></li>
          <li><a href="https://www.ucsf.edu/search">Search UCSF</a></li>
        </ul>
      </div>
    </div>
  `;
  
  // Insert banner before navbar
  var body = document.body;
  var navbar = document.querySelector('.navbar');
  if (navbar && navbar.parentNode) {
    navbar.parentNode.insertBefore(banner, navbar);
  } else {
    body.insertBefore(banner, body.firstChild);
  }
});
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Get the current page path
  var path = window.location.pathname;
  
  // Convert from .html to .md and adjust path
  // Remove /hpc/ from start if present for GitHub path
  var githubPath = path.replace(/\.html$/, '.md');
  if (githubPath.endsWith('/')) {
    githubPath += 'index.md';
  }
  
  // Create the edit link
  var repoUrl = 'https://github.com/ucsf-wynton/wynton-website-hpc';
  var editUrl = repoUrl + '/tree/master/docs' + githubPath;
  
  // Find the footer and add our custom links
  var footer = document.querySelector('.nav-footer');
  if (footer) {
    var rightDiv = footer.querySelector('.nav-footer-right');
    if (!rightDiv) {
      rightDiv = document.createElement('div');
      rightDiv.className = 'nav-footer-right';
      footer.appendChild(rightDiv);
    }
    
    rightDiv.innerHTML = '<ul class="footer-items list-unstyled">' +
      '<li class="nav-item">' +
      '<a class="nav-link" href="' + editUrl + '">' +
      '<i class="bi bi-pencil-square"></i> Edit this page' +
      '</a></li>' +
      '<li class="nav-item">' +
      '<a class="nav-link" href="' + repoUrl + '/issues/new">' +
      'Report an issue' +
      '</a></li>' +
      '</ul>';
  }
});
</script>


<link rel="stylesheet" href="../../hpc/assets/css/ucsf-banners.css">
<link rel="stylesheet" href="../../hpc/assets/css/bootstrap.min.css">
<link rel="stylesheet" href="../../hpc/assets/css/this_site.css">
<link rel="stylesheet" href="../../hpc/assets/css/broadcast.css">
<link rel="stylesheet" href="../../hpc/assets/css/checkbox-toggle.css">
<link rel="stylesheet" href="../../hpc/assets/css/docsearch.css">
<link rel="stylesheet" href="../../hpc/assets/css/quarto-customizations.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../hpc/assets/ico/favicon.ico" alt="" class="navbar-logo light-content">
    <img src="../../hpc/assets/ico/favicon.ico" alt="" class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">UCSF Wynton HPC Cluster</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../hpc/status/index.html"> 
<span class="menu-text">Status</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-get-started" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Get Started</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-get-started">    
        <li>
    <a class="dropdown-item" href="../../hpc/get-started/access-cluster.html">
 <span class="dropdown-text">1. Login &amp; Logout</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/get-started/development-prototyping.html">
 <span class="dropdown-text">2. Development / Prototyping</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/get-started/hello-world-job.html">
 <span class="dropdown-text">3. ‘Hello World’ Job</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/get-started/good-practices.html">
 <span class="dropdown-text">4. Good Practices</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/get-started/duo-signup.html">
 <span class="dropdown-text">5. 2FA Registration</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/get-started/protected-quickstart.html">
 <span class="dropdown-text">6. Wynton Protected Quickstart</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-software" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Software</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-software">    
        <li>
    <a class="dropdown-item" href="../../hpc/software/core-software.html">
 <span class="dropdown-text">Core Software</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/software/scl.html">
 <span class="dropdown-text">Software Collections (SCL)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/software/software-modules.html">
 <span class="dropdown-text">Software Modules</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/software/software-repositories.html">
 <span class="dropdown-text">Software Repositories</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/software/apptainer.html">
 <span class="dropdown-text">Linux Containers (Apptainer/Singularity)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/software/sbgrid.html">
 <span class="dropdown-text">SBGrid Software (restricted access)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/software/missing-software.html">
 <span class="dropdown-text">Missing Software?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/software/rocky-8-linux.html">
 <span class="dropdown-text">Migration to Rocky 8 Linux (Nov 2023)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-sge" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">SGE</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-sge">    
        <li>
    <a class="dropdown-item" href="../../hpc/scheduler/submit-jobs.html">
 <span class="dropdown-text">Submit Jobs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/scheduler/list-jobs.html">
 <span class="dropdown-text">List Jobs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/scheduler/kill-jobs.html">
 <span class="dropdown-text">Kill Jobs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/scheduler/job-summary.html">
 <span class="dropdown-text">Job Summary</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/scheduler/envvars.html">
 <span class="dropdown-text">Useful Env. Variables</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/scheduler/using-local-scratch.html">
 <span class="dropdown-text">Use Local Scratch</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/scheduler/queues.html">
 <span class="dropdown-text">Available Queues</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/scheduler/email-notifications.html">
 <span class="dropdown-text">Job Email Notifications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/scheduler/gpu.html">
 <span class="dropdown-text">GPU Scheduling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/scheduler/advanced-usage.html">
 <span class="dropdown-text">Advanced Usage</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-file-transfers" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">File Transfers</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-file-transfers">    
        <li>
    <a class="dropdown-item" href="../../hpc/transfers/files-and-directories.html">
 <span class="dropdown-text">Secure Copy File Transfers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/transfers/globus.html">
 <span class="dropdown-text">Globus File Transfers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/transfers/globus-sharing.html">
 <span class="dropdown-text">Globus File Sharing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/transfers/ucsf-box.html">
 <span class="dropdown-text">UCSF Box</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/transfers/dos2unix.html">
 <span class="dropdown-text">Windows-Unix File Transfers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/transfers/rclone.html">
 <span class="dropdown-text">rclone (mount Wynton file system locally)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-how-to" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">How To</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-how-to">    
        <li>
    <a class="dropdown-item" href="../../hpc/howto/matlab.html">
 <span class="dropdown-text">Work with MATLAB</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/howto/python.html">
 <span class="dropdown-text">Work with Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/howto/jupyter.html">
 <span class="dropdown-text">Work with Jupyter Notebook</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/howto/r.html">
 <span class="dropdown-text">Work with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/howto/rstudio.html">
 <span class="dropdown-text">Work with RStudio</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/howto/conda.html">
 <span class="dropdown-text">Work with Conda</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/howto/conda-stage.html">
 <span class="dropdown-text">Stage Conda Environment to Local Disk</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/howto/install-from-source.html">
 <span class="dropdown-text">Install Software from Source</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/howto/storage-size.html">
 <span class="dropdown-text">File Sizes and Disk Quotas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/howto/group-quota.html">
 <span class="dropdown-text">Adjust Group Disk Quota</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/howto/find-files.html">
 <span class="dropdown-text">Find Files</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/howto/log-in-without-pwd.html">
 <span class="dropdown-text">Log in without Password</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/howto/change-pwd.html">
 <span class="dropdown-text">Change &amp; Verify Password</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/howto/gui-x11fwd.html">
 <span class="dropdown-text">GUIs (X2Go &amp; X11)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/howto/jupyterhub.html">
 <span class="dropdown-text">JupyterHub Server (DISCONTINUED)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-support" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Support</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-support">    
        <li>
    <a class="dropdown-item" href="../../hpc/support/index.html">
 <span class="dropdown-text">Support Channels</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/support/faq.html">
 <span class="dropdown-text">Frequently Asked Questions</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-about" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">About</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-about">    
        <li>
    <a class="dropdown-item" href="../../hpc/about/specs.html">
 <span class="dropdown-text">Specifications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/about/gpus.html">
 <span class="dropdown-text">Available GPUs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/about/news.html">
 <span class="dropdown-text">News</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/about/pricing-storage.html">
 <span class="dropdown-text">Pricing: Extra Storage</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/about/pricing-compute.html">
 <span class="dropdown-text">Pricing: Extra Compute (CPU &amp; GPU)</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../../hpc/about/wynton-protected.html">
 <span class="dropdown-text">Wynton Protected (P3 Data)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/about/join.html">
 <span class="dropdown-text">Join ♡</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/about/shares.html">
 <span class="dropdown-text">Contributing Member Shares</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../../hpc/about/governance.html">
 <span class="dropdown-text">Governance</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/about/user-agreement.html">
 <span class="dropdown-text">User Agreement</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hpc/about/citation.html">
 <span class="dropdown-text">How to Cite</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../../hpc/about/contact.html">
 <span class="dropdown-text">Contact</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>




<div class="alert alert-info" role="alert">
<p>Wynton HPC has 61 GPU nodes with a total of 235 GPUs available to all users. Among these, 39 GPU nodes, with a total of 147 GPUs, were contributed by different research groups. On these nodes, GPU jobs from Wynton users not in the contributing lab are limited to 2 hours. In contrast, <a href="../../hpc/scheduler/queues.html">contributors are <em>not</em> limited to 2-hour GPU jobs on nodes they contributed</a>. On the institutional GPU nodes (i.e.&nbsp;those not contributed by any particular research group), the standard Wynton job length limit of 2 weeks applies for all users. There is also one GPU development node that is available to all users.</p>
</div>
<section id="gpu-scheduling" class="level1">
<h1>GPU Scheduling</h1>
<section id="compiling-gpu-applications" class="level2">
<h2 class="anchored" data-anchor-id="compiling-gpu-applications">Compiling GPU applications</h2>
<p>The <a href="https://developer.nvidia.com/cuda-toolkit">CUDA Toolkit</a> is installed on the <a href="../../hpc/get-started/development-prototyping.html">development nodes</a>. Several versions of CUDA are available via software modules. To see the currently available versions, run the command:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> avail cuda</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="submitting-gpu-jobs" class="level2">
<h2 class="anchored" data-anchor-id="submitting-gpu-jobs">Submitting GPU jobs</h2>
<p>GPU jobs run in a dedicated queue which must be requested in the job submission. Each slot in this queue represents a GPU that the job will use. Therefore, users must ensure that every job’s GPU use matches its submission request. For a job using a single GPU, the submission should look like:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">qsub</span> <span class="at">-q</span> gpu.q ...</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Jobs requiring more than one GPU must be submitted like this:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">qsub</span> <span class="at">-q</span> gpu.q <span class="at">-pe</span> smp N ...</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>where N is the number of GPUs the job will use.</p>
<p>If your application requires MPI, you should still use the proper parallel environment regardless of how many GPUs you’ll be using:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">qsub</span> <span class="at">-q</span> gpu.q <span class="at">-pe</span> mpi_onehost N ...</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">mpirun</span> <span class="at">-np</span> M <span class="at">--oversubscribe</span> ...</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>where N is the number of GPUs your job will use and M is the number of MPI processes your job will launch. M does not have to equal N (see below). Please note that, at the moment, each GPU job must limit itself to a single host.</p>
<p>NOTE: GPU jobs <em>must</em> include a runtime request, i.e.&nbsp;<code>-l h_rt=HH:MM:SS</code>. This allows for proper scheduling of GPU jobs on member and institutional nodes. If your job does not include a runtime request, it may be removed from the queue. Runtime requests are hard limits, so your job will be killed by SGE when it hits this limit. Be sure to request enough time for you job to finish.</p>
</section>
<section id="submitting-gpu-jobs-to-the-msg-4-gpu-nodes" class="level2">
<h2 class="anchored" data-anchor-id="submitting-gpu-jobs-to-the-msg-4-gpu-nodes">Submitting GPU jobs to the MSG 4-GPU nodes</h2>
<p>The 4gpu.q has {{ site.data.specs.msg_4gpus }} GPUs on {{ site.data.specs.msg_4gpu_nodes }} nodes. These GPUs are reserved such that all 4 on the node are reserved when a job is submitted to the queue.</p>
<p>To submit a 4-GPU job to a host a dedicated 4-GPU host, do this:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">qsub</span> <span class="at">-q</span> 4gpu.q ...</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>NOTE: The GPU servers in the 4gpu.q were all contributed by MSG Labs. If you are not a member of a MSG lab, for your job to run in the 4gpu.q, your job must have a run time (h_rt) of less than 2 hours.</p>
<div class="alert alert-warning" role="alert" style="margin-top: 3ex">
<p>Do not use a parallel environment (i.e.&nbsp;<code>-pe smp 4</code> or <code>-pe mpi_onehost 4</code>) for 4gpu.q as you would for gpu.q. If you do, the job will never start.</p>
</div>
</section>
<section id="submitting-multi-node-multi-gpu-jobs" class="level2">
<h2 class="anchored" data-anchor-id="submitting-multi-node-multi-gpu-jobs">Submitting Multi-Node Multi-GPU jobs</h2>
<div class="alert alert-warning" role="alert">
<p>2022-12-20: We are still testing this feature. Although basic use-case testing has been done, Multi-Node Multi-GPU jobs still haven’t been thoroughly validated by end users. If you run into issues or have suggestions to make the documentation clearer, please reach out to <a href="mailto::wynton-support@ucsf.edu">wynton-support@ucsf.edu</a>.</p>
</div>
<p>We have setup a trial of multi-node GPU jobs on Wynton. This enables you to run jobs on all the GPUs of more than one server. To run a multi-node GPU, job, you must do the following:</p>
<ol type="1">
<li><p>Submit to the MPI PE and request a number of slots equal to the number of GPUs you want to use. Assuming you want to use all A40s, the number should be a multiple of 4. Example: <code>"-pe mpi 8"</code>.</p></li>
<li><p>Request the “exclusive” resource: <code>"-l exclusive=true"</code></p></li>
</ol>
<p>And that’s all that’s required. You’ll need to use ‘mpirun’ to launch your applications on the hosts assigned to the job. And you’ll likely want to tailor the rest of your qsub flags to make sure you run on hosts with the same GPU types. Also, you’ll <em>really</em> want to set “-R y” to turn on reservations. As with all parallel jobs, keep in mind that the more resources you request, the longer your wait time will be.</p>
<p>More information about using OpenMPI is on our website here: <a href="../../hpc/scheduler/submit-jobs.html#mpi">Using OpenMPI on Wynton</a></p>
<p>Please let us know how your testing goes. We’ve done limited testing of our own (only the scheduling piece), but some things are sure to come up that we didn’t see there. We’ll be happy to tweak as we go along.</p>
<p>Suggestions:</p>
<ul>
<li>Some applications are finicky about the version of CUDA, load the correct CUDA module your program has been compiled against.</li>
<li>Make sure you are using the version of OpenMPI which your application has been compiled against.</li>
<li>You’ll want to be sure you use servers with matching models of GPUs and matching numbers of GPUs.</li>
</ul>
<p>In addition, a discussion group has been started on the Wynton Slack by the Wynton Users who are currently testing the feature:</p>
<p><a href="https://ucsf-wynton.slack.com/archives/C04B3U9S5S5">#multinode-multigpu</a></p>
</section>
<section id="gpu-relevant-resource-requests" class="level2">
<h2 class="anchored" data-anchor-id="gpu-relevant-resource-requests">GPU relevant resource requests</h2>
<p>The GPU nodes in Wynton HPC contain many different generations and models of NVIDIA GPUs. In order to ensure that your GPU jobs run on GPUs with the proper capabilities, there are two SGE resource complexes assigned to each GPU node:</p>
<ol type="1">
<li><p><code>compute_cap</code> - describes the Compute Capability (or SM version) of the GPUs in the node (see <a href="https://developer.nvidia.com/cuda-gpus">NVIDIA’s CUDA GPU page</a> for more details). <code>compute_cap</code> is an integer in keeping with the relevant flags to <code>nvcc</code>. For example, a Compute Capability of 6.1 (e.g.&nbsp;<a href="https://en.wikipedia.org/wiki/GeForce_10_series">GeForce GTX 1080</a>) is requested by <code>-l compute_cap=61</code>.</p></li>
<li><p><code>gpu_mem</code> - describes how much GPU memory the GPUs in the node have. It’s defined in units of MiB.</p></li>
</ol>
<p>Specifying either of these resources is not required. If you do specify one, your job will be scheduled on a GPU node with resources &gt;= those that you requested. As an example, if you wanted to only run on at least GeForce GTX 1080 generation nodes with more than 10 GiB of GPU memory, you would specify:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">-l</span> compute_cap=61,gpu_mem=10G</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="a40-gpu-node-cuda-compatibility" class="level2">
<h2 class="anchored" data-anchor-id="a40-gpu-node-cuda-compatibility">A40 GPU Node CUDA Compatibility</h2>
<p>If you see an error similar to <code>RuntimeError: CUDA error: no kernel image is available for execution on the device</code> this means your software has been compiled against a CUDA version which is not compatible with the GPU in the node your job is trying to run on. CUDA versions are usually backwards compatible. However, newer GPUs, like the A40 GPUs in the <code>qb3-atgpu</code> nodes, may require a minimum CUDA version. If your software is compiled against a version of CUDA less than <code>CUDA-11.1</code>, it will not run on the <code>qb3-atgpu</code> GPU nodes. To fix, recompile your software against the Wynton <code>cuda/11.5</code> module (preferable) or avoid the <code>qb3-atgpu</code> nodes (not recommended, as these are the fastest and most numerous institutional GPUs in the Wynton cluster). To tell the scheduler to skip the <code>qb3-atgpu</code> nodes, use limitation <code>-l hostname='!qb3-atgpu*'</code> on the command line or in your job script.</p>
</section>
<section id="running-gpu-applications" class="level2">
<h2 class="anchored" data-anchor-id="running-gpu-applications">Running GPU applications</h2>
<p>Several CUDA runtimes are installed on the GPU nodes. They can be loaded via modules just as above on the development nodes, e.g.&nbsp;<code>module load cuda</code> and <code>module load cuda/7.5</code>.</p>
<section id="gpu-selection" class="level3">
<h3 class="anchored" data-anchor-id="gpu-selection">GPU selection</h3>
<p>When your job is assigned to a node, it will also be assigned specific GPUs on that node. The GPU assignment will be contained in the environment variable <code>SGE_GPU</code> as a comma-delimited set of one or more non-negative integers where then number of integers corresponds to the number of GPU cores requested. For example, a 3-core GPU job (<code>-q gpu.q -pe smp 3</code>) may get assigned GPU cores <code>SGE_GPU=2,0,6</code> whereas a 1-core GPU job (<code>-q gpu.q</code>) may get assigned GPU core <code>SGE_GPU=5</code>. Be sure to send this GPU-core assignment to your application using the proper format for your application.</p>
<p>For example, if your application uses CUDA, you should limit which GPUs are used with:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">CUDA_VISIBLE_DEVICES</span><span class="op">=</span><span class="va">$SGE_GPU</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="alert alert-warning" role="alert">
<p>To avoid overloading GPUs, it is important that each job use only the GPUs it was assigned, which is given by environment variable <code>SGE_GPU</code>.</p>
</div>
</section>
<section id="cpu-core-usage" class="level3">
<h3 class="anchored" data-anchor-id="cpu-core-usage">CPU core usage</h3>
<p>Since we are using gpu.q slots to represent GPUs rather than the usual CPU cores, there is no way to ensure that a GPU node’s CPU cores don’t get oversubscribed. For this reason, please limit your CPU core usage to 4 CPU cores per GPU requested. This will prevent CPU core overloading on all the GPU node types.</p>
</section>
</section>
<section id="monitor-gpu-usage" class="level2">
<h2 class="anchored" data-anchor-id="monitor-gpu-usage">Monitor GPU usage</h2>
<section id="sge-summaries-on-gpu-usage-for-a-specific-machine" class="level3">
<h3 class="anchored" data-anchor-id="sge-summaries-on-gpu-usage-for-a-specific-machine">SGE summaries on GPU usage for a specific machine</h3>
<p>If you know the name of the compute node where your job is running, you can ask SGE to summarize the GPU usage on that machine, including use from other jobs than yours. This can be done from one the login and development hosts, e.g.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[alice@dev2</span> ~]$ qconf <span class="at">-se</span> msg-iogpu3</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hostname</span>              msg-iogpu3</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ex">load_scaling</span>          NONE</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="ex">complex_values</span>        mem_free=128000M</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="ex">load_values</span>           arch=lx-amd64,num_proc=32,mem_total=128739.226562M, <span class="dt">\</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                      swap_total=4095.996094M,virtual_total=132835.222656M, <span class="dt">\</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                      m_topology=SCTTCTTCTTCTTCTTCTTCTTCTTSCTTCTTCTTCTTCTTCTTCTTCTT, <span class="dt">\</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                      m_socket=2,m_core=16,m_thread=32,load_avg=5.020000, <span class="dt">\</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                      load_short=4.640000,load_medium=5.020000, <span class="dt">\</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                      load_long=5.110000,mem_free=124798.726562M, <span class="dt">\</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>                      swap_free=4095.996094M,virtual_free=128894.722656M, <span class="dt">\</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>                      mem_used=3940.500000M,swap_used=0.000000M, <span class="dt">\</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                      virtual_used=3940.500000M,cpu=17.700000, <span class="dt">\</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                      m_topology_inuse=SCTTCTTCTTCTTCTTCTTCTTCTTSCTTCTTCTTCTTCTTCTTCTTCTT, <span class="dt">\</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>                      np_load_avg=0.156875,np_load_short=0.145000, <span class="dt">\</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>                      np_load_medium=0.156875,np_load_long=0.159688, <span class="dt">\</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>                      gpu.ncuda=2,gpu.ndev=2,gpu.cuda.0.mem_free=758054912, <span class="dt">\</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>                      gpu.cuda.0.procs=1,gpu.cuda.0.clock=2025, <span class="dt">\</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>                      gpu.cuda.0.util=57,gpu.cuda.1.mem_free=758054912, <span class="dt">\</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>                      gpu.cuda.1.procs=1,gpu.cuda.1.clock=2025, <span class="dt">\</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>                      gpu.cuda.1.util=54,gpu.names=GeForce GTX 1080<span class="kw">;</span><span class="ex">GeForce</span> <span class="dt">\</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>                      GTX 1080<span class="kw">;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="ex">processors</span>            32</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="ex">user_lists</span>            NONE</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="ex">xuser_lists</span>           NONE</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="ex">projects</span>              NONE</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="ex">xprojects</span>             NONE</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="ex">usage_scaling</span>         NONE</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="ex">report_variables</span>      NONE</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This tells us that host <code>msg-iogpu3</code> has two GeForce GTX 1080 GPUs. Each GPU is running one process, each is just over 50% utilized, and each has approximately 722 MiB (758,054,912 bytes) of free memory.</p>
</section>
<section id="gpu-profiling-from-within-job" class="level3">
<h3 class="anchored" data-anchor-id="gpu-profiling-from-within-job">GPU profiling from within job</h3>
<p>One can also use NVIDIA’s <a href="https://docs.nvidia.com/datacenter/dcgm/latest/index.html">Data Center GPU Manager</a> to get detailed profiling of GPU jobs. To use it, add the following at the beginning of your job script <em>before</em> you launch the software tools that use the GPUs:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="va">gpuprof</span><span class="op">=</span><span class="va">$(</span><span class="ex">dcgmi</span> group <span class="at">--create</span> mygpus <span class="at">--add</span> <span class="st">"</span><span class="va">$SGE_GPU</span><span class="st">"</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">'{print $10}'</span><span class="va">)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">dcgmi</span> stats <span class="at">--group</span> <span class="st">"</span><span class="va">$gpuprof</span><span class="st">"</span> <span class="at">--enable</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ex">dcgmi</span> stats <span class="at">--group</span> <span class="st">"</span><span class="va">$gpuprof</span><span class="st">"</span> <span class="at">--jstart</span> <span class="st">"</span><span class="va">$JOB_ID</span><span class="st">"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Make sure to stop the GPU profile when the job finishes, by putting the following at the end of your job script:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">dcgmi</span> stats <span class="at">--group</span> <span class="st">"</span><span class="va">$gpuprof</span><span class="st">"</span> <span class="at">--jstop</span> <span class="st">"</span><span class="va">$JOB_ID</span><span class="st">"</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">dcgmi</span> stats <span class="at">--group</span> <span class="st">"</span><span class="va">$gpuprof</span><span class="st">"</span> <span class="at">--verbose</span> <span class="at">--job</span> <span class="st">"</span><span class="va">$JOB_ID</span><span class="st">"</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ex">dcgmi</span> group <span class="at">--delete</span> <span class="st">"</span><span class="va">$gpuprof</span><span class="st">"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The GPU stats will be written to the job’s output file.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/wynton\.ucsf\.edu\/hpc\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="https://www.ucsf.edu/">UCSF</a> :: <a href="https://wynton.ucsf.edu/">Wynton</a> :: <a href="../../hpc/">Wynton HPC</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>